# 今日学んだこと

## 取り組んだ課題一覧
-  LT会（1h10m）
     - ECS on Fargateの構成要素について（発表＋資料作成）
-  ULT会（1h）
     - Web3層アーキテクチャについて（資料作成）
         -  ULT会の発表者が多く発表できなかったため、次回のLT会で発表する
- ハッカソン(4h)
    - backend
         -  RDSパラメータ設計
    - infra
         -  インフラ設計・アーキテクチャ図修正

【アーキテクチャ図の主な変更点】
- **AWS Secrets Manager**を追加
    - Secrets Manager はグローバルサービスではなく、各リージョン単位で提供されるサービスであるため、
ECSと同じ東京リージョンに配置
※ECSタスク（Fargate）から安全に認証情報へアクセスできる構成に修正
→ リソースを配置についての認識が合っているのか怪しい...
- グローバルに**AWS Cost Explorer**を追加
    - コストの管理・分析を目的とし、グローバルサービスにリソースを配置しました。
- CI/CDと分離して、**定期的にDB Migration の自動実行する構成**を導入
    - FastAPIアプリのデプロイタイミングとは別に、定期スケジュールにとってDBスキーマの変更を実施できるように構成を分離

**処理の流れ（DB Migration定期実行）**：
1. EventBridge Schedulerが指定したcronスケジュールで起動する（イベント発火）
2. RunTask起動用のLambda関数がトリガーになり、ECSクラスター内のRunTaskを呼び出す
3. 指定されたFargate タスク（DB Migration）が起動する 
4. Fargate タスク内のコンテナでDB Migration（Alembic）処理を実行する（alembic upgrade head）
5. Migration処理完了後、コンテナが終了し、タスクも自動的に終了

![alt text](20250425.png)
 
## わかったこと
- パラメータ設計とは
    - アプリケーションの利用特性（例：アクセス頻度、データ量、クエリ傾向）、同時接続数、パフォーマンス要件（応答速度、スループットなど）に応じて、データベース（RDS）の各種設定値（パラメータ）を最適に調整し、性能、安定性、セキュリティ、運用性を最大化する作業
- RDSパラメータ設計の目的について
    - データベースのパフォーマンス、安定性、セキュリティ、運用性を最大化するため

## 感じたこと
- LT会での発表を初見でも相手が理解しやすいように心がける
- DB設計は運用や障害、スケーラビリティを見据えたチューニングや設計の積み重ねが求められる
- DB設計について、使用技術の選定やER図を作成だけかと思ったが、そうではなかった（「ER図を作って終わり」は設計の50%程度）
    - **要件定義・利用特性の整理**
         - 同時接続数、読み書き頻度（OLTP/OLAP）、アクセスパターン（例：チャット、検索、バッチ）
         - データ保持期間、バックアップ、可用性要件    
    - **論理設計（ER図、正規化）**
         - テーブル、リレーション、主キー、外部キー、インデックス設計
         - パフォーマンス要件に応じた正規化と非正規化のバランス
    - **物理設計**
         -  カラム型、NULL制約、インデックス詳細、UNIQUE制約
         -  コードサイズ、見積もり容量、将来的なスケーラビリティ
    - **パラメータ設計（RDS側のチューニング）**
         -  アプリの挙動・同時アクセスに耐えられるように最適化
    - **運用設計・可観測性設計**
         -  モニタリング（CloudWatch）、アラーム、ログ設定（general_log / slow_query_log）
         -  バックアップ設計（スナップショット/自動バックアップ）
    -  **セキュリティ設計** 
         -  パスワード管理、IAMとの連携、VPC内配置、パブリックアクセスの制御 
    
## 次やること
- backend
    - RDSパラメータ設計を技術メンターさんへFBを依頼する
    - 機能実装
- infra
    - 一旦基本構成は完成したので、RDSパラメータ設計が完了次第、構成図に加える

## 学習時間
- Today: 6h 10m
- week : 19h 40m
- Total: 31h 25m