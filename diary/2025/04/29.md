# 今日学んだこと

## 取り組んだ課題一覧
- ハッカソン（4h）
    - ミーティング(2h)
         - 管理者ログインの設計     
         - SLA作成について（一旦は白紙になったが、簡易的なSLAを作成することになった）
    - backend(2h)
         - API設計の修正・整理 
- 中間発表の資料作成

※ミーティングや勉強会は学習時間に含めません。

## わかったこと
- 管理者ログインの設計
    - ログイン後の画面遷移（ルーティング制御）
         - role === "admin" なら /admin/home へ遷移
         - role === "user" なら /user/home へ遷移
         - PINが違う → APIから 401 や 403 を返し、ポップアップで表示
    - frontend側でPINコードを保持しており、正しいコードを入力した場合にのみ/admin-formへ遷移可能
    - 間違った場合は画面遷移を拒否し、ポップアップで警告表示
    - 一般ユーザーは/homeへ遷移するように制御
- 環境構築    
    - FastAPI本体の起動前にマイグレーション用コンテナが実行される必要ある

## 感じたこと
- 中間発表資料では、アーキテクチャに加えて「選定理由（なぜFargateなのか）」「障害時の考慮」なども入れる
- SLAの簡易化については「稼働率」「応答時間」「障害通知フロー」の3点に絞っておくと実用的
- EventBridge + Lambda + RunTaskでの定期実行
    - 毎晩のマイグレーションは、スキーマ変更を含まないような軽量な「状態修復タスク」などに使える良いパターン

## 次やること
- infra
    - アーキテクチャ図を修正（RDSパラメータ設計と計画メンテナンスや一時的な障害が発生した際の対応を組み込む）
    - タスク定義の流れを理解する（sidecarコンテナ,initコンテナ,通常のコンテナ）
         - DBマイグレーションはサイドカー（またはイニット）コンテナで一度のみ実行
         - FastAPI本体の起動前にマイグレーション用コンテナが実行される必要ある
         - `dependsOn`属性を活用して、コンテナの起動順序を制御
    - EventBridgeとRunTaskの活用
         - 毎晩0時にEventBridge + Lambda + RunTaskでマイグレーションを実行する構成
         - 初期デプロイ時に手動でRDSへマイグレーションする場合と、EventBridgeで定期実行のみの場合で挙動が異なる点に注意
         - タスク定義に書かなくてもEventBridge側のサービスで定義できるのかについて調べる
    - ci.yml(frontend)を修正
         - 認証情報（API URL、管理者PIN、Cognitoなど）をGitHub Secretsに保持
         - CI/CD上でビルド直前に`.env`ファイルを生成し、PINなどの変数を書き込む
         - `.env`の動的生成により環境依存を排除
- 講師案件
    - 講義資料を確認
    - お打ち合わせの準備
         - 資料の読み込み・理解

## 学習時間
- Today: 2h
- week : 8h
- Total: 50h 55m